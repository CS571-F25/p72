import{r as c,a as h,j as n,t as N}from"./index-BOURYf87.js";const $=120*1e3,y=new Map;function D({lat:d,lon:u}){const[C,g]=c.useState(!0),[E,x]=c.useState(null),[m,v]=c.useState([]),a=c.useRef(!0),S=Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC";c.useEffect(()=>{a.current=!0;const e=`${d},${u}`,o=y.get(e),w=Date.now();if(o&&w-o.ts<$){v(o.intervals),g(!1),x(null);const t=new AbortController;return(async()=>{try{const r="https://weather-app-backend-blond.vercel.app",f=new URLSearchParams({location:`${d},${u}`}),b=r?`${r}/api/weather-forecast?${f.toString()}`:`/api/weather-forecast?${f.toString()}`,s=(await h.get(b,{signal:t.signal})).data,l=s?.data?.timelines?.[0]?.intervals||s?.timelines?.[0]?.intervals||s?.data?.intervals||s?.intervals;if(l&&Array.isArray(l)&&l.length>0){const A=l.slice(0,24);y.set(e,{ts:Date.now(),intervals:A}),a.current&&v(A)}}catch(r){if(r?.name==="CanceledError"||r?.name==="AbortError"||r?.code==="ERR_CANCELED"||h.isCancel?.(r))return;console.warn("HourlyForecast background refresh failed:",r?.message||r)}})(),()=>{a.current=!1}}g(!0),x(null);const p=new AbortController;return(async()=>{try{const t="https://weather-app-backend-blond.vercel.app",r=new URLSearchParams({location:`${d},${u}`}),f=t?`${t}/api/weather-forecast?${r.toString()}`:`/api/weather-forecast?${r.toString()}`,i=(await h.get(f,{signal:p.signal})).data,s=i?.data?.timelines?.[0]?.intervals||i?.timelines?.[0]?.intervals||i?.data?.intervals||i?.intervals;if(!s||!Array.isArray(s)||s.length===0)throw new Error("No hourly data returned");const l=s.slice(0,24);y.set(e,{ts:Date.now(),intervals:l}),a.current&&v(l)}catch(t){if(t?.name==="CanceledError"||t?.name==="AbortError"||t?.code==="ERR_CANCELED"||h.isCancel?.(t))return;a.current&&x(t?.message||String(t))}finally{a.current&&g(!1)}})(),()=>{a.current=!1,p.abort()}},[d,u]);const j=c.useMemo(()=>m.map(e=>{const o=new Date(e.startTime),w=e.values?.temperature??e.values?.temperatureApparent??null,p=e.values?.precipitationProbability??e.values?.precipitation??null,t=e.values?.windSpeed??null;return{t:o,temp:w,pop:p,wind:t}}),[m]);return C&&m.length===0?n.jsxs("div",{className:"py-2",children:[n.jsx("div",{className:"text-sm text-muted-foreground",children:"Hourly (24h)"}),n.jsx("div",{className:"mt-2",children:"Loading hourly forecast…"})]}):E&&m.length===0?n.jsxs("div",{className:"py-2 text-sm text-red-500",children:["Error loading forecast: ",E]}):n.jsxs("div",{className:"py-2",children:[n.jsx("div",{className:"text-sm text-muted-foreground mb-3 font-medium",children:"Hourly (24h)"}),n.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:j.map((e,o)=>n.jsxs("div",{className:"flex-none w-16 p-2 text-center flex flex-col items-center justify-center rounded-lg bg-gray-50 dark:bg-slate-800 text-xs",children:[n.jsx("div",{className:"text-muted-foreground truncate w-full",children:e.t.toLocaleTimeString([],{hour:"numeric",timeZone:S})}),n.jsx("div",{className:"font-semibold mt-1",children:e.temp==null?"—":N(e.temp)})]},o))})]})}export{D as default};
