import{r as c,a as g,j as n,t as N}from"./index-DwdoLGty.js";const $=120*1e3,y=new Map;function D({lat:u,lon:d}){const[C,x]=c.useState(!0),[E,w]=c.useState(null),[m,v]=c.useState([]),a=c.useRef(!0),S=Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC";c.useEffect(()=>{a.current=!0;const e=`${u},${d}`,o=y.get(e),p=Date.now();if(o&&p-o.ts<$){v(o.intervals),x(!1),w(null);const r=new AbortController;return(async()=>{try{const t="https://weather-app-backend-blond.vercel.app",h=new URLSearchParams({location:`${u},${d}`}),b=t?`${t}/api/weather-forecast?${h.toString()}`:`/api/weather-forecast?${h.toString()}`,s=(await g.get(b,{signal:r.signal})).data,l=s?.data?.timelines?.[0]?.intervals||s?.timelines?.[0]?.intervals||s?.data?.intervals||s?.intervals;if(l&&Array.isArray(l)&&l.length>0){const A=l.slice(0,24);y.set(e,{ts:Date.now(),intervals:A}),a.current&&v(A)}}catch(t){if(t?.name==="CanceledError"||t?.name==="AbortError"||t?.code==="ERR_CANCELED"||g.isCancel?.(t))return;console.warn("HourlyForecast background refresh failed:",t?.message||t)}})(),()=>{a.current=!1}}x(!0),w(null);const f=new AbortController;return(async()=>{try{const r="https://weather-app-backend-blond.vercel.app",t=new URLSearchParams({location:`${u},${d}`}),h=r?`${r}/api/weather-forecast?${t.toString()}`:`/api/weather-forecast?${t.toString()}`,i=(await g.get(h,{signal:f.signal})).data,s=i?.data?.timelines?.[0]?.intervals||i?.timelines?.[0]?.intervals||i?.data?.intervals||i?.intervals;if(!s||!Array.isArray(s)||s.length===0)throw new Error("No hourly data returned");const l=s.slice(0,24);y.set(e,{ts:Date.now(),intervals:l}),a.current&&v(l)}catch(r){if(r?.name==="CanceledError"||r?.name==="AbortError"||r?.code==="ERR_CANCELED"||g.isCancel?.(r))return;a.current&&w(r?.message||String(r))}finally{a.current&&x(!1)}})(),()=>{a.current=!1,f.abort()}},[u,d]);const j=c.useMemo(()=>m.map(e=>{const o=new Date(e.startTime),p=e.values?.temperature??e.values?.temperatureApparent??null,f=p==null?null:Math.round(p),r=e.values?.precipitationProbability??e.values?.precipitation??null,t=e.values?.windSpeed??null;return{t:o,temp:f,pop:r,wind:t}}),[m]);return C&&m.length===0?n.jsxs("div",{className:"py-2",children:[n.jsx("div",{className:"text-sm text-muted-foreground",children:"Hourly (24h)"}),n.jsx("div",{className:"mt-2",children:"Loading hourly forecast…"})]}):E&&m.length===0?n.jsxs("div",{className:"py-2 text-sm text-red-500",children:["Error loading forecast: ",E]}):n.jsxs("div",{className:"py-2",children:[n.jsx("div",{className:"text-sm text-muted-foreground mb-3 font-medium",children:"Hourly (24h)"}),n.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:j.map((e,o)=>n.jsxs("div",{className:"flex-none w-16 p-2 text-center flex flex-col items-center justify-center rounded-lg bg-gray-50 dark:bg-slate-800 text-xs",children:[n.jsx("div",{className:"text-muted-foreground truncate w-full",children:e.t.toLocaleTimeString([],{hour:"numeric",timeZone:S})}),n.jsx("div",{className:"font-semibold mt-1",children:e.temp==null?"—":N(e.temp)})]},o))})]})}export{D as default};
