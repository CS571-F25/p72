import{r as i,a as x,j as s,t as S}from"./index-DwvpDoLE.js";const j=120*1e3,E=new Map,$=o=>{const c=Date.now(),p=o.filter(u=>new Date(u.startTime).getTime()>=c);return(p.length?p:o).slice(0,24)};function R({lat:o,lon:c}){const[p,u]=i.useState(!0),[b,w]=i.useState(null),[f,v]=i.useState([]),l=i.useRef(!0),C=Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC";i.useEffect(()=>{l.current=!0;const a=`${o},${c}`,r=E.get(a),y=Date.now();if(r&&y-r.ts<j){v(r.intervals),u(!1),w(null);const t=new AbortController;return(async()=>{try{const e="https://weather-app-backend-blond.vercel.app",g=new URLSearchParams({location:`${o},${c}`}),A=e?`${e}/api/weather-forecast?${g.toString()}`:`/api/weather-forecast?${g.toString()}`,n=(await x.get(A,{signal:t.signal})).data,m=n?.data?.timelines?.[0]?.intervals||n?.timelines?.[0]?.intervals||n?.data?.intervals||n?.intervals;m&&Array.isArray(m)&&m.length>0&&(E.set(a,{ts:Date.now(),intervals:m}),l.current&&v(m))}catch(e){if(e?.name==="CanceledError"||e?.name==="AbortError"||e?.code==="ERR_CANCELED"||x.isCancel?.(e))return;console.warn("HourlyForecast background refresh failed:",e?.message||e)}})(),()=>{l.current=!1}}u(!0),w(null);const h=new AbortController;return(async()=>{try{const t="https://weather-app-backend-blond.vercel.app",e=new URLSearchParams({location:`${o},${c}`}),g=t?`${t}/api/weather-forecast?${e.toString()}`:`/api/weather-forecast?${e.toString()}`,d=(await x.get(g,{signal:h.signal})).data,n=d?.data?.timelines?.[0]?.intervals||d?.timelines?.[0]?.intervals||d?.data?.intervals||d?.intervals;if(!n||!Array.isArray(n)||n.length===0)throw new Error("No hourly data returned");E.set(a,{ts:Date.now(),intervals:n}),l.current&&v(n)}catch(t){if(t?.name==="CanceledError"||t?.name==="AbortError"||t?.code==="ERR_CANCELED"||x.isCancel?.(t))return;l.current&&w(t?.message||String(t))}finally{l.current&&u(!1)}})(),()=>{l.current=!1,h.abort()}},[o,c]);const N=i.useMemo(()=>$(f).map(r=>{const y=new Date(r.startTime),h=r.values?.temperature??r.values?.temperatureApparent??null,t=r.values?.precipitationProbability??r.values?.precipitation??null,e=r.values?.windSpeed??null;return{t:y,temp:h,pop:t,wind:e}}),[f]);return p&&f.length===0?s.jsxs("div",{className:"py-2",children:[s.jsx("div",{className:"text-sm text-muted-foreground",children:"Hourly (24h)"}),s.jsx("div",{className:"mt-2",children:"Loading hourly forecast…"})]}):b&&f.length===0?s.jsxs("div",{className:"py-2 text-sm text-red-500",children:["Error loading forecast: ",b]}):s.jsxs("div",{className:"py-2",children:[s.jsx("div",{className:"text-sm text-muted-foreground mb-3 font-medium",children:"Hourly (24h)"}),s.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:N.map((a,r)=>s.jsxs("div",{className:"flex-none w-16 p-2 text-center flex flex-col items-center justify-center rounded-lg bg-gray-50 dark:bg-slate-800 text-xs",children:[s.jsx("div",{className:"text-muted-foreground truncate w-full",children:a.t.toLocaleTimeString([],{hour:"numeric",timeZone:C})}),s.jsx("div",{className:"font-semibold mt-1",children:a.temp==null?"—":S(a.temp)})]},r))})]})}export{R as default};
