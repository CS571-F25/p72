import{r as c,a as x,j as n,C as N,t as $}from"./index-BkIZZPbM.js";const R=120*1e3,y=new Map;function L({lat:u,lon:d}){const[A,g]=c.useState(!0),[E,w]=c.useState(null),[m,v]=c.useState([]),a=c.useRef(!0),S=Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC";c.useEffect(()=>{a.current=!0;const e=`${u},${d}`,o=y.get(e),p=Date.now();if(o&&p-o.ts<R){v(o.intervals),g(!1),w(null);const r=new AbortController;return(async()=>{try{const t="https://weather-app-backend-blond.vercel.app",h=new URLSearchParams({location:`${u},${d}`}),b=t?`${t}/api/weather-forecast?${h.toString()}`:`/api/weather-forecast?${h.toString()}`,s=(await x.get(b,{signal:r.signal})).data,l=s?.data?.timelines?.[0]?.intervals||s?.timelines?.[0]?.intervals||s?.data?.intervals||s?.intervals;if(l&&Array.isArray(l)&&l.length>0){const C=l.slice(0,24);y.set(e,{ts:Date.now(),intervals:C}),a.current&&v(C)}}catch(t){if(t?.name==="CanceledError"||t?.name==="AbortError"||t?.code==="ERR_CANCELED"||x.isCancel?.(t))return;console.warn("HourlyForecast background refresh failed:",t?.message||t)}})(),()=>{a.current=!1}}g(!0),w(null);const f=new AbortController;return(async()=>{try{const r="https://weather-app-backend-blond.vercel.app",t=new URLSearchParams({location:`${u},${d}`}),h=r?`${r}/api/weather-forecast?${t.toString()}`:`/api/weather-forecast?${t.toString()}`,i=(await x.get(h,{signal:f.signal})).data,s=i?.data?.timelines?.[0]?.intervals||i?.timelines?.[0]?.intervals||i?.data?.intervals||i?.intervals;if(!s||!Array.isArray(s)||s.length===0)throw new Error("No hourly data returned");const l=s.slice(0,24);y.set(e,{ts:Date.now(),intervals:l}),a.current&&v(l)}catch(r){if(r?.name==="CanceledError"||r?.name==="AbortError"||r?.code==="ERR_CANCELED"||x.isCancel?.(r))return;a.current&&w(r?.message||String(r))}finally{a.current&&g(!1)}})(),()=>{a.current=!1,f.abort()}},[u,d]);const j=c.useMemo(()=>m.map(e=>{const o=new Date(e.startTime),p=e.values?.temperature??e.values?.temperatureApparent??null,f=p==null?null:Math.round(p),r=e.values?.precipitationProbability??e.values?.precipitation??null,t=e.values?.windSpeed??null;return{t:o,temp:f,pop:r,wind:t}}),[m]);return A&&m.length===0?n.jsxs("div",{className:"py-2",children:[n.jsx("div",{className:"text-sm text-muted-foreground",children:"Hourly (24h)"}),n.jsx("div",{className:"mt-2",children:"Loading hourly forecast…"})]}):E&&m.length===0?n.jsxs("div",{className:"py-2 text-sm text-red-500",children:["Error loading forecast: ",E]}):n.jsxs("div",{className:"py-2",children:[n.jsx("div",{className:"text-sm text-muted-foreground mb-3 font-medium",children:"Hourly (24h)"}),n.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:j.map((e,o)=>n.jsxs(N,{className:"flex-none w-20 p-2 text-center flex flex-col items-center justify-center",children:[n.jsx("div",{className:"text-xs text-muted-foreground truncate w-full",children:e.t.toLocaleTimeString([],{hour:"numeric",timeZone:S})}),n.jsx("div",{className:"text-sm font-semibold mt-2",children:e.temp==null?"—":$(e.temp)})]},o))})]})}export{L as default};
